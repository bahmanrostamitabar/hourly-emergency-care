---
title: Short-term hourly forecasting in urgent and emergency care
author:
  - name: Author1
    email: email1@example.com
    affiliation: University1
    footnote: 1
  - name: Author2
    email: email2@example.com
    affiliation: University2
    footnote: 2
  - name: Author3
    email: email3@example.com
    affiliation: University3
    footnote: 2
address:
  - code: University1
    address: Cardiff business school, 3 Colum Drive, CF10 3EU, Cardiff
  - code: University2
    address: adress2
  - code: University3
    address: adress3
footnote:
  - code: 1
    text: "Corresponding Author"
  - code: 2
    text: "Equal contribution"
    
abstract: |
   The Objective of this work would be to propose a new methodology to forecast short-term hourly forecasting for urgent and emergency care.
   
journal: "Which journal? Journal of Service Research/Health Services Research/EJOR/IJF"
date: "`r Sys.Date()`"
geometry: "top=25mm, left=30mm, right=30mm, bottom=25mm,headsep=10mm, footskip=12mm"
#linenumbers: true
numbersections: true
#output: rticles::elsevier_article
header-includes:  
 \usepackage{adjustbox, float} #use the 'float' package
output:
  bookdown::pdf_book: 
    base_format: rticles::elsevier_article
    citation_package: natbib
bibliography: mybibfile.bib
biblio-style: authoryear
#csl: elsevier-without-titles.csl
#biblio-style: abbrevnat
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, fig.pos = 'H')
# Make sure you have the latest versions of rmarkdown and rticle
library(tidyverse)
library(lubridate)
library(bookdown)
h2_hourly <- readr::read_rds("../data/hw_hourly.rds")
```

# Introduction

Our contributions are as following:

1. We measure the characteristics of the time series at the original level and at various levels of aggregation. We reveal how TA influences the time series characteristics. 
2. We develope a model to discover the relationship between the original time series characteristics and the forecasting performance evaluation results to construct rules for method selection.
3. We determine for which type of time series characteristics, each TA forecasting strategy is preferable.

The rest of the paper is organised as follwoing: section \ref{lit} provides a brief overview of the use of temporal aggregation in time series forecasting. Section \ref{model} starts with ... 


# Research background:  Hourly short-term forecasting in emergency care {#lit}

\begin{table}[h]
\caption{Summary of studies in hourly emergency care forecasting} 
\centering 
\begin{adjustbox}{width=1\textwidth}
\small

\begin{tabular}{clllll} 
\hline
Authors & What to forecast & Method & Forecast evaluation & Limitations  \\ 
\hline 

\citet{hertzum2017forecasting} & Hourly ED patient arrivals and ED occupancy forecasting using calendar variables  1-3 & Regression, ARIMA, naive & MAPE & blabla\\ 
\citet{mccarthy2008challenge} & To develop methodology for predicting demand for ED services by characterizing ED arrivals  1-3 & Poissopn regression & RMSE & blabla\\ 
\citet{morzuch2006forecasting} & hourly ED arrivals for 24 hours & Holt-Winters & MAPE & blabla\\ 


\hline
\end{tabular}
\end{adjustbox}
\label{tab:lit-summary}
\end{table}


Table \@ref(tab:lit-summary) summarise studies in hourly forecasting in emergency and urgent care.


Linear regression, ARIMA, and naive models were used by @hertzum2017forecasting to investigate whether accurate hourly accident and emergency department patient arrivals and occupancy forecasts can be generated using calendar variables. Naive model was there for the purpose of comparison. @hertzum2017forecasting study shows that patient arrivals variation is larger across the hours of the day than across the days of the week and the months of the year. In term of hour of the day, patient arrivals peaked around noon. For days of the week, Monday is the busiest day while weekends are the quietest days. July-August are the month with the highest number of patient arrivals and January and February are the months with the lowest number of arrivals. The regression and ARIMA models perform similarly for all forecast interval in modeling patient arrivals. In modeling accident and emergency department occupancy, ARIMA outperform regression models. However, afterall, the models of occupancy were less accurate than those arrivals. @hertzum2017forecasting mentioned that ARIMA models are among the most accurate models for accident and emergency department visits forecasting. Another interesting point is that the accuracy of accident and emergency department forecasting models decrease with the increasing forecast interval. Lastly, the accuracy of the forecasting model may possibly be increased with additional information added to the model.

Predicting the arrivals of accident and emergency department future patients is studied by @choudhury2020forecasting ARIMA, Holt-Winters, TBATS, and neutral network methods were implemented to forecast hourly accident and emergency department arrivals. ARIMA model was selected as the best fit model and it has provided high and acceptable hourly accident and emergency department forecasting accuracy. @hertzum2017forecasting work was mentioned in this paper. It is said that residual normality, stationarity, and autocorrelation have not been tested in @hertzum2017forecasting paper and this might be the cause of accuracy problems. However, residual normality, stationarity, and autocorrelation are tested and compared with Holt-Winters, TBATS, and neutral network methods in @choudhury2020forecasting 
According to the studies mentioned earlier, it can be said that the existing studies have shown complications in forecasting hourly patient accident and emergency department visits and the application of forecasting hourly patients visits is not well established. Some of the studies said that the accuracy of hourly accident and emergency department forecasting model is low compared to other longer forecasting intervals like daily forecast [@boyle2012predicting; @hertzum2017forecasting]. However, some studies mentioned that the accuracy of accident and emergency department hourly forecast is at the acceptable level [@choudhury2020forecasting; @mccarthy2008challenge;  @schweigler2009forecasting].

The literature review reveals some limitations in forecasting for urgent and emergency care which will be summarised as follows:

- first, 
- second,
- third, 


# Proposed model {#model}

# Experimental design {#design}

## data {#data}

Figure \@ref(fig:hourly-plot)

```{r hourly-plot, fig.cap = 'Seasonal plot of ED attendance', fig.align='center',out.width="80%"}
h2_hourly <- h2_hourly %>% filter(arrival_1h >="2015-01-01 00:00:00"&arrival_1h <"2019-01-01 00:00:00")
  subseriesplot <- h2_hourly %>% as_tibble() %>% mutate(day=factor(yday(arrival_1h)),year=factor(year(arrival_1h)),hour=hour(arrival_1h)) %>% 
    select(-arrival_1h)
time <-  format( seq.POSIXt(as.POSIXct(Sys.Date()), as.POSIXct(Sys.Date()+1), by = "1 hour"),
                 "%H:%M", tz="GMT")
time <- time[-length(time)]
p1 <- ggplot(data=subseriesplot,mapping = aes(x=hour ,y=n_attendance, colour=day))+
    geom_line(aes(group=interaction(day,year)))+
    geom_point()+
    theme_bw()+
    theme(legend.position = "")+
    labs(y="Number of visits in ED", x="Hour of day")+
      scale_x_continuous(breaks=0:23, labels = time)+
  theme(axis.text.x = element_text(angle = 90))
  p1+theme(plot.title = element_text(size = 10))
```

Figure \@ref(fig:24hour)

```{r 24hour, fig.cap= "Distrubution of ED attendance for each hour of day", fig.align='center',fig.width=6, fig.height=9}
h2_hourly %>% as_tibble() %>% mutate(Date=date(arrival_1h),Hour=hour(arrival_1h)) %>% 
  select(-arrival_1h) %>% ggplot(mapping=aes(x=n_attendance))+ 
geom_histogram(mapping=aes(y=stat(density)), binwidth = 1,fill="white",color = 'black')+
  geom_density(color="blue")+
scale_y_continuous(labels = scales::percent_format())+
facet_wrap(~Hour, scales = "free", ncol = 3)+
theme_bw()+
labs(x="Number of visits in ED", y="Percentage")+
theme(axis.text = element_text(size = 7))
```

## benchmarks {#benchmarks}

\begin{equation}
\bar{X} = \frac{\sum_{i=1}^n X_i}{n} (\#eq:mean)
\end{equation}

Also see Equation \@ref(eq:mean)

## forecast performance evaluation {#accuracy}

# Result and discussion {#result}

# Conclusion {#conclusion}

# References {#references .unnumbered}
